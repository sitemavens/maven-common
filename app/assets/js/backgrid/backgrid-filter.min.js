//This file was created manually, because contains change from the original

(function(e,t,n,r,i){"use strict";var s=r.Extension.ServerSideFilter=n.View.extend({tagName:"form",className:"backgrid-filter form-search",template:t.template('<div class="input-prepend input-append"><span class="add-on"><i class="icon-search"></i></span><input type="text" <% if (placeholder) { %> placeholder="<%- placeholder %>" <% } %> name="<%- name %>" /><span class="add-on"><a class="close" href="#">Ã—</a></span></div>',null,{evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g}),events:{"click .close":"clear",submit:"search"},name:"q",placeholder:null,initialize:function(e){r.requireOptions(e,["collection"]);n.View.prototype.initialize.apply(this,arguments);this.name=e.name||this.name;this.placeholder=e.placeholder||this.placeholder;var t=this.collection,i=this;if(n.PageableCollection&&t instanceof n.PageableCollection&&t.mode=="server"){t.queryParams[this.name]=function(){return i.$el.find("input[type=text]").val()}}},search:function(e){if(e)e.preventDefault();var t={};t[this.name]=this.$el.find("input[type=text]").val();this.collection.fetch({data:t})},clear:function(e){if(e)e.preventDefault();this.$("input[type=text]").val(null);this.collection.fetch()},render:function(){this.$el.empty().append(this.template({name:this.name,placeholder:this.placeholder,value:this.value}));this.delegateEvents();return this}});var o=r.Extension.ClientSideFilter=s.extend({events:{"click .close":function(e){e.preventDefault();this.clear()},"change input[type=text]":"search","keyup input[type=text]":"search",submit:function(e){e.preventDefault();this.search()}},fields:null,wait:149,initialize:function(e){s.prototype.initialize.apply(this,arguments);this.fields=e.fields||this.fields;this.wait=e.wait||this.wait;this._debounceMethods(["search","clear"]);var n=this.collection;var r=this.shadowCollection=n.clone();r.url=n.url;r.sync=n.sync;r.parse=n.parse;this.listenTo(n,"add",function(e,t,n){r.add(e,n)});this.listenTo(n,"remove",function(e,t,n){r.remove(e,n)});this.listenTo(n,"sort reset",function(e,n){n=t.extend({reindex:true},n||{});if(n.reindex)r.reset(e.models)})},_debounceMethods:function(e){if(t.isString(e))e=[e];this.undelegateEvents();for(var n=0,r=e.length;n<r;n++){var i=e[n];var s=this[i];this[i]=t.debounce(s,this.wait)}this.delegateEvents()},makeMatcher:function(e){var t=new RegExp(e.trim().split(/\W/).join("|"),"i");return function(e){var n=this.fields||e.keys();for(var r=0,i=n.length;r<i;r++){if(t.test(e.get(n[r])+""))return true}return false}},search:function(){var e=t.bind(this.makeMatcher(this.$("input[type=text]").val()),this);this.collection.reset(this.shadowCollection.filter(e),{reindex:false})},clear:function(){this.$("input[type=text]").val(null);this.collection.reset(this.shadowCollection.models,{reindex:false})}});r.Extension.LunrFilter=o.extend({ref:"id",fields:null,initialize:function(e){o.prototype.initialize.apply(this,arguments);this.ref=e.ref||this.ref;var t=this.collection;this.listenTo(t,"add",this.addToIndex);this.listenTo(t,"remove",this.removeFromIndex);this.listenTo(t,"reset",this.resetIndex);this.listenTo(t,"change",this.updateIndex);this.resetIndex(t)},resetIndex:function(e,n){n=t.extend({reindex:true},n||{});if(n.reindex){var r=this;this.index=i(function(){t.each(r.fields,function(e,t){this.field(t,e);this.ref(r.ref)},this)});e.each(function(e){this.addToIndex(e)},this)}},addToIndex:function(e){var t=this.index;var n=e.toJSON();if(t.documentStore.has(n[this.ref]))t.update(n);else t.add(n)},removeFromIndex:function(e){var t=this.index;var n=e.toJSON();if(t.documentStore.has(n[this.ref]))t.remove(n)},updateIndex:function(e){var n=e.changedAttributes();if(n&&!t.isEmpty(t.intersection(t.keys(this.fields),t.keys(n)))){this.index.update(e.toJSON())}},search:function(){var e=this.index.search(this.$("input[type=text]").val());var t=[];for(var n=0;n<e.length;n++){var r=e[n];t.push(this.shadowCollection.get(r.ref))}this.collection.reset(t,{reindex:false})}})})(jQuery,_,Backbone,Backgrid,lunr)